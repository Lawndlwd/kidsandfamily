<div class="col-md-3 customAlert" [class.visible]="success">
  <div class="alert alert-success alert-dismissible fade show" role="alert" >
    <strong>Génial,</strong> <br> toutes les modifications ont été bien enregistrées
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
</div>
<div class="col-md-3 customAlert" [class.visible]="failed">
  <div class="alert alert-danger alert-dismissible fade show" role="alert" >
    <strong>Ah, quelque chose s'est mal passé</strong> <br>Vous devez vérifier certains de ces champs ci-dessous.
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
</div>
<div class="row justify-content-center m-0 p-0 mt-5">
  <div class="col-xs-11 col-md-11 col-md-offset-3 ">
    <div class="text-center spinner my-auto position-absolute" *ngIf = "isLoading" >
      <app-loading-spinner></app-loading-spinner>
    </div>

    <form class="text-center  p-4" #myInfoForm="ngForm" (ngSubmit)="onSubmit()" *ngIf = "!isLoading">
      <p class="h4 mb-4">General informations</p>
      <div class="row justify-content-between ">
        <div class="md-form col-11 col-md-5 col-lg-3 px-0 mt-3">

          <label for="Nom">Nom</label>
          <input mdbInput type="text" id="Nom" class="form-control " [(ngModel)]="loadedData.LastName" name= lastName  required minlength="2 " #lastName="ngModel"/>


          <div class="text-left" *ngIf="lastName.invalid && (lastName.dirty || lastName.touched)" >
            <small class="text-danger text-left" *ngIf="lastName.errors.required">
              Le nom est obligatoire.
            </small>
            <small class="text-danger text-left" *ngIf="lastName.errors.minlength">
              Le nom doit comporter au moins 2 caractères.
            </small>
          </div>

        </div>


        <div class="md-form col-10 col-md-5 col-lg-3 px-0 col-11 col-md-5 col-lg-3">

          <label for="Prenom">Prénom</label>
          <input mdbInput type="text" id="Prenom" class="form-control " [(ngModel)]="loadedData.firstName" name=firstName  required minlength="2" #firstName="ngModel" />

          <div class="text-left" *ngIf="firstName.invalid && (firstName.dirty || firstName.touched)" >
            <small class="text-danger " *ngIf="firstName.errors.required">
              Le prénom est obligatoire
            </small>
            <small class="text-danger text-left" *ngIf="firstName.errors.minlength">
              Le prénom doit comporter au moins 2 caractères.
            </small>
          </div>

        </div>
        <div class="md-form col-10 col-md-5 col-lg-5 mt-3 px-0">
          <label for="email">Email</label>
          <input mdbInput type="email" id="email" class="form-control"  [(ngModel)]="loadedData.email" name= email required email #email="ngModel"  />

          <div class="text-left" *ngIf="email.invalid && (email.dirty || email.touched)" >
            <small class="text-danger text-left" *ngIf="email.errors.required">
              Email est obligatoire
            </small>
            <small class="text-danger text-left" *ngIf="email.errors.email">
              L'e-mail doit être une adresse e-mail valide
            </small>
          </div>


        </div>

      </div>

      <div class="row justify-content-between ">
        <div class="form-group col-10 col-md-5 col-lg-3 mt-3 px-0">
          <div id="date-picker-example" class="text-left md-outline input-with-post-icon datepicker" inline="true"  >
            <label for="dataOfBrith">Date de naissance</label>
            <input  placeholder="Select date" type="date" id="dataOfBrith" class=" form-control"
                    [(ngModel)]="loadedData.bithday" name= birthday   #birthday="ngModel" >
          </div>


        </div>
        <div class="form-group col-10 col-md-5 col-lg-3 mt-3  text-left px-0">
          <label for="maritalStatus">Marital Status</label>
          <select class="browser-default custom-select" id="maritalStatus" [(ngModel)]="loadedData.maritalStatus" name= maritalStatus    #maritalStatus="ngModel">
            <option value="m">Marié</option>
            <option value="c">Célibataire</option>
            <option value="d">Divorcé</option>
          </select>
        </div>

        <div class="form-group col-10 col-md-5 col-lg-3 mt-3 text-left px-0">
          <label for="genre">Genre</label>
          <select id="genre" class="browser-default custom-select" [(ngModel)]="loadedData.gender" name= gender    #gender="ngModel">
            <option value="m">Male</option>
            <option value="f">Female</option>
          </select>

        </div>
      </div>
      <div class="row justify-content-between ">
        <div class="md-form col-10 col-md-5 col-lg-3 mt-3  px-0 ">
          <label for="tele-fix ">Téléphone Fix</label>
          <input mdbInput type="tel" id="tele-fix " class="form-control " [(ngModel)]="loadedData.phoneFix" name= "teleFix" pattern='^(01|02|03|04|05|08|09)[0-9]{8}$'   #teleFix="ngModel" />


          <div class="text-left" *ngIf="teleFix.invalid && (teleFix.dirty || teleFix.touched)" >
            <small  class="form-text text-danger">
              Invalid Phone number
            </small>
          </div>

        </div>
        <div class="md-form col-10 col-md-5 col-lg-3 mt-3 px-0">
          <label for="tele-mob ">Téléphone Mobile</label>
          <input mdbInput type="tel" id="tele-mob " class="form-control " [(ngModel)]="loadedData.phoneMobile" name="telemob" pattern='^((\+)33|0)[1-9](\d{2}){4}$'   #telemob="ngModel" />


          <div class="text-left" *ngIf="telemob.invalid && (telemob.dirty || telemob.touched)" >
            <div class=" text-left" *ngIf="telemob.errors.pattern">
              <small id="passwordHelpBlockMD" class="form-text text-danger">
                Invalid Phone number
              </small>

            </div>
          </div>

        </div>

        <div class="form-group col-10 col-md-5 col-lg-3 text-left mt-3 px-0">
          <label for="profession">Profession</label>
          <select id="profession" class="browser-default custom-select "  [(ngModel)]="!loadedData.profession ? professionDefault : loadedData.profession.id"  name= profession    #profession="ngModel" >
            <option  *ngFor="let profession of loadedProf" [value]="profession.id ">{{ profession.profession }}</option>
          </select>
        </div>
      </div>

      <div>
        <button class="mt-5" mdbBtn color="amber" mdbWavesEffect type="submit " [disabled]="!myInfoForm.valid " >{{"Enregistrer"}}</button>
      </div>
    </form>
  </div>
</div>
<div class="row justify-content-around" *ngIf = "!isLoading">
  <div class="card shadow mb-4 col-lg-11"  *ngIf="hasProfile">
    <div class="card-header py-3">
      <h6 class="m-0 font-weight-bold text-primary">{{'Liste des profils' | uppercase}}</h6>
    </div>
    <div class="card-body">
      <div class="table-responsive">
        <table class="display table"  width="100%">    <thead>
        <tr>
          <!--      <th *ngFor="let head of headElements; let i = index" aria-controls="tableSortExample" scope="col" [mdbTableSort]="users" [sortBy]="headElements[i]">{{head}}-->
          <!--      </th>-->
          <th>#</th>
          <th [mdbTableSort]="profiles" sortBy="type.type">Type</th>
          <th [mdbTableSort]="profiles" sortBy="sousType.sousType">Sous Type</th>
          <th [mdbTableSort]="profiles" sortBy="nameVoie">Rue</th>
          <th [mdbTableSort]="profiles" sortBy="city">Ville</th>
          <th scope="col">Éditer</th>
          <th scope="col">Supprimer</th>
        </tr>
        </thead>
          <tfoot>
          <tr>
            <td class="text-center" colspan="7">
              <pagination-controls lang="fr" id="profileList" maxSize="6" directionLinks=false (pageChange)="page = $event"></pagination-controls>
            </td>
          </tr>
          </tfoot>
          <tbody>
          <tr *ngFor="let i = index; let el of profiles | paginate: {id: 'profileList', itemsPerPage: 5, currentPage: page1, totalItems: NumberOfProfile }">
            <td>{{i+1}}</td>
            <td>{{el.type.type}}</td>
            <td>{{el.sousType.sousType}}</td>
            <td>{{el.numVoie}} {{el.nameVoie}}</td>
            <td>{{el.codePostal}} {{el.city}}</td>
            <td>
              <a  routerLink="/admin/profile/{{el.id}}/edit"><mdb-icon class="purple-text" fas icon="pencil-alt"></mdb-icon></a>
            </td>
            <td>
              <mdb-icon fas icon="trash-alt" (click)="basicModal.show()" class="pink-text ml-3"  mdbWavesEffect></mdb-icon>

              <div mdbModal #basicModal="mdbModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myBasicModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close pull-right" aria-label="Close" (click)="basicModal.hide()">
                        <span aria-hidden="true">×</span>
                      </button>
                      <h4 class="modal-title w-100" id="myModalLabel">Attention</h4>
                    </div>
                    <div class="modal-body">
                      Supprimer  profil<br>
                      Toutes les publications liées à ce profil seront supprimées, vous ne pourrez plus récupérer cette profil

                    </div>
                    <div class="modal-footer">
                      <button type="button" mdbBtn color="deep-purple" class="waves-light" aria-label="Close" (click)="basicModal.hide()" mdbWavesEffect>Annuler</button>
                      <button type="button" mdbBtn color="red" class="relative waves-light" mdbWavesEffect (click)="basicModal.hide(); onDelete(el.id);" >Confirmer la suppression</button>
                    </div>
                  </div>
                </div>
              </div></td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <div class="card shadow mb-4 col-lg-11"  *ngIf="!hasProfile">
    L'utilisateur n'a pas encore des profils
  </div>
  </div>
<div class="row justify-content-around" *ngIf = "!isLoading">
  <div class="card shadow mb-4 col-lg-11" *ngIf="hasPubs">
  <div class="card-header py-3">
    <h6 class="m-0 font-weight-bold text-primary">{{"Liste des Publications" | uppercase}}</h6>
  </div>
  <div class="card-body">
    <div class="table-responsive">
      <table class="display table" id="dataTable" width="100%">
        <thead>
        <tr>
          <td>#</td>
          <th [mdbTableSort]="pubs" sortBy="title">Titre</th>
          <th [mdbTableSort]="pubs" sortBy="structure.name">Structure</th>
          <th [mdbTableSort]="pubs" sortBy="profile.state">Region</th>
          <th [mdbTableSort]="pubs" sortBy="publicCible.name">Public</th>
          <th [mdbTableSort]="pubs" sortBy="createdAtAgo">Date de creation</th>
        </tr>
        </thead>
        <tfoot>
        <tr>
          <td class="text-center" colspan="6">
            <pagination-controls lang="fr" id="pubsList" maxSize="6" directionLinks="false" (pageChange)="page = $event"></pagination-controls>
          </td>
        </tr>
        </tfoot>
        <tbody>
        <tr *ngFor="let i = index; let el of pubs | paginate: {id: 'pubsList', itemsPerPage: 5, currentPage: page, totalItems: NumberOfPub }">
          <td>{{i+1}}</td>
          <td>{{el.title}}</td>
          <td>{{el.structure ? el.structure.name : ''}}</td>
          <td>{{el.profile ? el.profile.state : ''}}</td>
          <td>{{el.publicCible ? el.publicCible.name : ''}}</td>
          <td>{{el.createdAtAgo }}</td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>

</div>
  <div class="card shadow mb-4 col-lg-11"  *ngIf="!hasPubs">
    L'utilisateur n'a pas encore des publications
  </div>
</div>

